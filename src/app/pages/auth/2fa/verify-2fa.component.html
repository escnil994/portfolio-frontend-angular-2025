<section class="hero-section relative min-h-screen flex items-center justify-center overflow-hidden">
  <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-accent/5"></div>
  <div class="absolute top-20 left-10 w-72 h-72 bg-primary/10 rounded-full blur-3xl animate-pulse-slow"></div>
  <div class="absolute bottom-20 right-10 w-96 h-96 bg-accent/10 rounded-full blur-3xl animate-pulse-slow"
    style="animation-delay: 2s;"></div>

  <div class="container mx-auto px-4 relative z-10">
    <div class="max-w-md mx-auto">
      <div class="text-center mb-8 animate-fade-in">
        <div class="mb-6">
          <div
            class="w-20 h-20 mx-auto bg-gradient-to-br from-primary to-accent rounded-2xl flex items-center justify-center shadow-lg shadow-primary/20 animate-bounce-slow">
            <span class="material-icons text-4xl text-white">verified_user</span>
          </div>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-3">
          <span class="bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent">
            Verify Your Identity
          </span>
        </h1>
        <p class="text-base-content/70 text-lg">
          @switch (selectedMethod()) {
            @case ('totp') { Use the code from your authenticator app. }
            @case ('email') { Use the 6-digit code sent to your email. }
            @case ('backup') { Enter one of your 8-digit backup codes. }
          }
        </p>
      </div>

      <div class="card bg-base-100 shadow-2xl border border-base-300 animate-slide-up">
        <div class="card-body p-8">

          @if (availableMethods().length > 1) {
          <div role="tablist" class="tabs tabs-boxed grid-cols-3 mb-6">
            @if (availableMethods().includes('totp')) {
            <a role="tab" class="tab"
               [class.tab-active]="selectedMethod() === 'totp'"
               (click)="selectMethod('totp')">
              <span class="material-icons text-base mr-1">smartphone</span> App
            </a>
            }
            @if (availableMethods().includes('email')) {
            <a role="tab" class="tab"
               [class.tab-active]="selectedMethod() === 'email'"
               (click)="selectMethod('email')">
              <span class="material-icons text-base mr-1">email</span> Email
            </a>
            }
            @if (availableMethods().includes('backup')) {
            <a role="tab" class="tab"
               [class.tab-active]="selectedMethod() === 'backup'"
               (click)="selectMethod('backup')">
              <span class="material-icons text-base mr-1">emergency</span> Backup
            </a>
            }
          </div>
          }

          <form [formGroup]="verifyForm" (ngSubmit)="onSubmit()" class="space-y-6">
            @if (errorMessage()) {
            <div class="alert alert-error shadow-lg animate-shake">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>{{ errorMessage() }}</span>
            </div>
            }
            @if (successMessage()) {
            <div class="alert alert-success shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>{{ successMessage() }}</span>
            </div>
            }

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-center w-full">
                  @switch (selectedMethod()) {
                    @case ('totp') { Authenticator Code }
                    @case ('email') { Email Verification Code }
                    @case ('backup') { Backup Code }
                  }
                </span>
              </label>
              <div class="relative">
                <input type="text" formControlName="code"
                  [maxlength]="selectedMethod() === 'backup' ? 9 : 6"
                  [attr.inputmode]="selectedMethod() === 'backup' ? 'text' : 'numeric'"
                  [placeholder]="selectedMethod() === 'backup' ? 'XXXX-XXXX' : '000000'"
                  class="input input-bordered w-full text-center text-3xl font-mono focus:input-primary transition-all"
                  [class.tracking-[1rem]]="selectedMethod() !== 'backup'"
                  [class.tracking-widest]="selectedMethod() === 'backup'"
                  [class.input-error]="verifyForm.get('code')?.invalid && verifyForm.get('code')?.touched"
                  (input)="onCodeInput($event)"
                  autocomplete="one-time-code" />
              </div>
            </div>

            <button type="submit" [disabled]="verifyForm.invalid || authService.loading()"
              class="btn btn-primary w-full gap-2 shadow-lg hover:shadow-xl transition-all group">
              @if (authService.loading()) {
              <span class="loading loading-spinner"></span>
              Verifying...
              } @else {
              <span class="material-icons">check_circle</span>
              Verify Code
              }
            </button>

            @if (selectedMethod() === 'email') {
            <div class="text-center pt-2">
              <p class="text-sm text-base-content/60 mb-2">
                @if (!emailSent()) {
                  Click below to send a code to your email.
                } @else {
                  Didn't receive the code?
                }
              </p>
              <button type="button" (click)="requestEmailCode()" [disabled]="resendTimer() > 0"
                class="btn btn-ghost btn-sm gap-2">
                @if (resendTimer() > 0) {
                <span class="material-icons text-base">schedule</span>
                Resend in {{ resendTimer() }}s
                } @else {
                <span class="material-icons text-base">refresh</span>
                @if (!emailSent()) { Send Code } @else { Resend Code }
                }
              </button>
            </div>
            }

            <div class="text-center pt-2">
              <a routerLink="/private/user/me/login" class="link link-hover text-primary gap-1 inline-flex items-center group">
                <span class="material-icons text-sm group-hover:-translate-x-1 transition-transform">arrow_back</span>
                Back to Login
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
