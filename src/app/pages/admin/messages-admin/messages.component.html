<div class="max-w-6xl mx-auto space-y-8 py-8 animate-fade-in">

  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <div class="flex items-center gap-3">
      <span class="material-icons text-primary text-3xl">mail</span>
      <h1 class="text-3xl font-bold">Contact Messages</h1>
    </div>

    <div class="join">
      <button class="btn btn-sm join-item"
              [class.btn-primary]="currentFilter() === 'unread'"
              (click)="changeFilter('unread')">
        Unread ({{ stats().unread_count }})
      </button>
      <button class="btn btn-sm join-item"
              [class.btn-primary]="currentFilter() === 'read'"
              (click)="changeFilter('read')">
        Responded
      </button>
      <button class="btn btn-sm join-item"
              [class.btn-primary]="currentFilter() === 'all'"
              (click)="changeFilter('all')">
        All ({{ stats().total_messages }})
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="flex justify-center items-center min-h-[400px]">
      <div class="text-center">
        <span class="loading loading-spinner loading-lg text-primary"></span>
        <p class="text-base-content/60 mt-4">Loading messages...</p>
      </div>
    </div>
  } @else {

    @if (messages().length === 0) {
      <div class="card bg-base-100 shadow-xl border border-base-300">
        <div class="card-body items-center text-center">
          <span class="material-icons text-5xl text-base-content/30">inbox</span>
          <h2 class="card-title">All Clear!</h2>
          <p>No messages found for this filter.</p>
        </div>
      </div>
    } @else {
      <div class="space-y-6">
        @for (message of messages(); track message.id) {
          <div class="card bg-base-100 shadow-xl border border-base-300 transition-all hover:shadow-2xl">
            <div class="card-body p-6">

              <div class="flex flex-col md:flex-row justify-between gap-2 border-b border-base-300 pb-4 mb-4">
                <div class="flex items-center gap-3">
                  @if (!message.read) {
                    <span class="w-3 h-3 bg-primary rounded-full animate-pulse" title="Unread"></span>
                  } @else {
                    <span class="material-icons text-success text-xl" title="Responded">check_circle</span>
                  }
                  <div>
                    <p class="font-bold text-lg">{{ message.name }}</p>
                    <p class="text-sm text-base-content/60">{{ message.email }}</p>
                  </div>
                </div>
                <div class="text-sm font-light text-base-content/70 md:text-right">
                  {{ message.created_at | date:'medium' }}
                </div>
              </div>

              <div class="space-y-2">
                <h3 class="font-semibold text-xl">
                  {{ message.subject || 'No Subject' }}
                </h3>
                <p class="whitespace-pre-wrap text-base-content/90">
                  {{ message.message }}
                </p>
              </div>

              <div class="card-actions justify-end border-t border-base-300 pt-4 mt-4 gap-2">
                <button (click)="onDelete(message)" class="btn btn-sm btn-ghost text-error gap-1">
                  <span class="material-icons text-sm">delete</span> Delete
                </button>
                @if (message.read) {
                  <button (click)="onToggleRead(message)" class="btn btn-sm btn-ghost gap-1">
                    <span class="material-icons text-sm">mark_as_unread</span> Mark as Unread
                  </button>
                } @else {
                  <button (click)="onToggleRead(message)" class="btn btn-sm btn-ghost gap-1">
                    <span class="material-icons text-sm">check</span> Mark as Responded
                  </button>
                }
                <button (click)="onReply(message)" class="btn btn-sm btn-primary gap-1">
                  <span class="material-icons text-sm">reply</span> Reply
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    }
  }
</div>
